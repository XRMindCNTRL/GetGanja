// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  role      String   @default("CUSTOMER")
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  customerProfile CustomerProfile?
  vendorProfile   VendorProfile?
  driverProfile   DriverProfile?
  orders          Order[]
  addresses       Address[]

  @@map("users")
}

model CustomerProfile {
  id          String @id @default(cuid())
  userId      String @unique
  dateOfBirth DateTime?
  verified    Boolean @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("customer_profiles")
}

model VendorProfile {
  id          String @id @default(cuid())
  userId      String @unique
  businessName String
  businessType String
  licenseNumber String @unique
  licenseExpiry DateTime
  address     String
  latitude    Float?
  longitude   Float?
  phone      String
  email      String
  isApproved Boolean @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  products Product[]

  @@map("vendor_profiles")
}

model DriverProfile {
  id          String @id @default(cuid())
  userId      String @unique
  licenseNumber String @unique
  vehicleType String
  vehiclePlate String @unique
  isAvailable Boolean @default(true)
  rating     Float @default(5.0)
  totalDeliveries Int @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  deliveries Delivery[]

  @@map("driver_profiles")
}

model Product {
  id          String @id @default(cuid())
  vendorId    String
  name        String
  description String?
  price       Float
  category    String
  strain      String?
  thcContent  Float?
  cbdContent  Float?
  weight      Float?
  unit        String @default("g")
  stock       Int @default(0)
  isActive    Boolean @default(true)
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  vendor  VendorProfile @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]

  @@map("products")
}

model Address {
  id        String @id @default(cuid())
  userId    String
  type      String @default("HOME")
  street    String
  city      String
  province  String
  postalCode String
  latitude  Float?
  longitude Float?
  isDefault Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("addresses")
}

model Order {
  id          String @id @default(cuid())
  userId      String
  status      String @default("PENDING")
  totalAmount Float
  deliveryFee Float @default(0)
  taxAmount   Float @default(0)
  discount    Float @default(0)
  finalAmount Float
  paymentMethod String?
  paymentStatus String @default("PENDING")
  deliveryAddress String
  deliveryLat Float?
  deliveryLng Float?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  items      OrderItem[]
  delivery   Delivery?

  @@map("orders")
}

model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Float
  total     Float
  createdAt DateTime @default(now())

  // Relations
  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

model Delivery {
  id          String @id @default(cuid())
  orderId     String @unique
  driverId    String
  status      String @default("ASSIGNED")
  estimatedArrival DateTime?
  actualArrival DateTime?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  order  Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  driver DriverProfile @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@map("deliveries")
}


